<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestão de Projetos e Funcionários</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#1E40AF',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <h1 class="text-3xl font-bold text-gray-900">Sistema de Gestão</h1>
                <div class="flex space-x-4">
                    <button id="projetosTab" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors">
                        Projetos
                    </button>
                    <button id="funcionariosTab" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors">
                        Funcionários
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Projetos Section -->
        <div id="projetosSection" class="space-y-6">
            <!-- Projetos Header -->
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-900">Gestão de Projetos</h2>
                <button id="novoProjetoBtn" class="px-4 py-2 bg-success text-white rounded-lg hover:bg-green-600 transition-colors">
                    + Novo Projeto
                </button>
            </div>

            <!-- Projetos List -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Lista de Projetos</h3>
                </div>
                <div id="projetosList" class="divide-y divide-gray-200">
                    <!-- Projetos serão carregados aqui via JavaScript -->
                </div>
            </div>
        </div>

        <!-- Funcionários Section -->
        <div id="funcionariosSection" class="space-y-6 hidden">
            <!-- Funcionários Header -->
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-900">Gestão de Funcionários</h2>
                <button id="novoFuncionarioBtn" class="px-4 py-2 bg-success text-white rounded-lg hover:bg-green-600 transition-colors">
                    + Novo Funcionário
                </button>
            </div>

            <!-- Funcionários List -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Lista de Funcionários</h3>
                </div>
                <div id="funcionariosList" class="divide-y divide-gray-200">
                    <!-- Funcionários serão carregados aqui via JavaScript -->
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Projetos -->
    <div id="projetoModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 id="projetoModalTitle" class="text-lg font-semibold text-gray-900">Novo Projeto</h3>
                </div>
                <form id="projetoForm" class="p-6 space-y-4">
                    <div>
                        <label for="projetoNome" class="block text-sm font-medium text-gray-700">Nome do Projeto</label>
                        <input type="text" id="projetoNome" name="nome" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label for="projetoDataCriacao" class="block text-sm font-medium text-gray-700">Data de Criação</label>
                        <input type="date" id="projetoDataCriacao" name="dataCriacao" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelarProjeto" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Funcionários -->
    <div id="funcionarioModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 id="funcionarioModalTitle" class="text-lg font-semibold text-gray-900">Novo Funcionário</h3>
                </div>
                <form id="funcionarioForm" class="p-6 space-y-4">
                    <div>
                        <label for="funcionarioNome" class="block text-sm font-medium text-gray-700">Nome</label>
                        <input type="text" id="funcionarioNome" name="nome" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label for="funcionarioCpf" class="block text-sm font-medium text-gray-700">CPF</label>
                        <input type="text" id="funcionarioCpf" name="cpf" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label for="funcionarioEmail" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="funcionarioEmail" name="email" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div>
                        <label for="funcionarioSalario" class="block text-sm font-medium text-gray-700">Salário</label>
                        <input type="number" id="funcionarioSalario" name="salario" step="0.01" required
                               class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary">
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelarFuncionario" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Associar Funcionários ao Projeto -->
    <div id="associarModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 id="associarModalTitle" class="text-lg font-semibold text-gray-900">Associar Funcionários ao Projeto</h3>
                </div>
                <div class="p-6">
                    <div id="funcionariosDisponiveis" class="space-y-2 max-h-96 overflow-y-auto">
                        <!-- Funcionários disponíveis serão carregados aqui -->
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelarAssociar" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 transition-colors">
                            Cancelar
                        </button>
                        <button type="button" id="salvarAssociacoes" class="px-4 py-2 bg-primary text-white rounded-md hover:bg-secondary transition-colors">
                            Salvar Associações
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast para notificações -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300">
        <span id="toastMessage">Operação realizada com sucesso!</span>
    </div>

    <script>
        // Configuração dos endpoints da API
        const API_ENDPOINTS = {
            projetos: {
                base: 'http://localhost:8080/api/projetos',
                get: 'http://localhost:8080/api/projetos',
                post: 'http://localhost:8080/api/projetos'
            },
            funcionarios: {
                base: 'http://localhost:8080/api/funcionarios',
                get: 'http://localhost:8080/api/funcionarios',
                post: 'http://localhost:8080/api/funcionarios'
            }
        };

        // Estado da aplicação
        let projetos = [];
        let funcionarios = [];
        let projetoEditando = null;
        let funcionarioEditando = null;
        let projetoParaAssociar = null;

        // Elementos do DOM
        const projetosSection = document.getElementById('projetosSection');
        const funcionariosSection = document.getElementById('funcionariosSection');
        const projetosTab = document.getElementById('projetosTab');
        const funcionariosTab = document.getElementById('funcionariosTab');
        const projetosList = document.getElementById('projetosList');
        const funcionariosList = document.getElementById('funcionariosList');
        const projetoModal = document.getElementById('projetoModal');
        const funcionarioModal = document.getElementById('funcionarioModal');
        const associarModal = document.getElementById('associarModal');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            carregarProjetos();
            carregarFuncionarios();
        });

        function setupEventListeners() {
            // Tabs
            projetosTab.addEventListener('click', () => mostrarSecao('projetos'));
            funcionariosTab.addEventListener('click', () => mostrarSecao('funcionarios'));

            // Botões de novo
            document.getElementById('novoProjetoBtn').addEventListener('click', () => abrirModalProjeto());
            document.getElementById('novoFuncionarioBtn').addEventListener('click', () => abrirModalFuncionario());

            // Modais
            document.getElementById('cancelarProjeto').addEventListener('click', () => fecharModalProjeto());
            document.getElementById('cancelarFuncionario').addEventListener('click', () => fecharModalFuncionario());
            document.getElementById('cancelarAssociar').addEventListener('click', () => fecharModalAssociar());

            // Formulários
            document.getElementById('projetoForm').addEventListener('submit', salvarProjeto);
            document.getElementById('funcionarioForm').addEventListener('submit', salvarFuncionario);
            document.getElementById('salvarAssociacoes').addEventListener('click', salvarAssociacoes);

            // Fechar modais clicando fora
            projetoModal.addEventListener('click', (e) => {
                if (e.target === projetoModal) fecharModalProjeto();
            });
            funcionarioModal.addEventListener('click', (e) => {
                if (e.target === funcionarioModal) fecharModalFuncionario();
            });
            associarModal.addEventListener('click', (e) => {
                if (e.target === associarModal) fecharModalAssociar();
            });
        }

        function mostrarSecao(secao) {
            if (secao === 'projetos') {
                projetosSection.classList.remove('hidden');
                funcionariosSection.classList.add('hidden');
                projetosTab.className = 'px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors';
                funcionariosTab.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors';
            } else {
                projetosSection.classList.add('hidden');
                funcionariosSection.classList.remove('hidden');
                funcionariosTab.className = 'px-4 py-2 bg-primary text-white rounded-lg hover:bg-secondary transition-colors';
                projetosTab.className = 'px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors';
            }
        }

        // Funções para Projetos
        async function carregarProjetos() {
            try {
                const response = await fetch(API_ENDPOINTS.projetos.get);
                if (response.ok) {
                    projetos = await response.json();
                    renderizarProjetos();
                } else {
                    console.error('Erro ao carregar projetos:', response.statusText);
                    mostrarToast('Erro ao carregar projetos', 'error');
                }
            } catch (error) {
                console.error('Erro ao carregar projetos:', error);
                mostrarToast('Erro de conexão ao carregar projetos', 'error');
            }
        }

        function renderizarProjetos() {
            projetosList.innerHTML = '';
            if (projetos.length === 0) {
                projetosList.innerHTML = '<div class="p-6 text-center text-gray-500">Nenhum projeto cadastrado</div>';
                return;
            }

            projetos.forEach(projeto => {
                const projetoDiv = document.createElement('div');
                projetoDiv.className = 'p-6 hover:bg-gray-50';
                projetoDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold text-gray-900">${projeto.nome}</h4>
                            <p class="text-sm text-gray-600">Criado em: ${new Date(projeto.dataCriacao).toLocaleDateString('pt-BR')}</p>
                            <div class="mt-2">
                                <span class="text-sm text-gray-500">Funcionários associados: ${projeto.funcionarios ? projeto.funcionarios.length : 0}</span>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="abrirModalAssociar(${projeto.id})" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                                Associar Funcionários
                            </button>
                            <button onclick="editarProjeto(${projeto.id})" class="px-3 py-1 text-sm bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 transition-colors">
                                Editar
                            </button>
                            <button onclick="excluirProjeto(${projeto.id})" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors">
                                Excluir
                            </button>
                        </div>
                    </div>
                `;
                projetosList.appendChild(projetoDiv);
            });
        }

        function abrirModalProjeto(projeto = null) {
            projetoEditando = projeto;
            const form = document.getElementById('projetoForm');
            const title = document.getElementById('projetoModalTitle');
            
            if (projeto) {
                title.textContent = 'Editar Projeto';
                form.nome.value = projeto.nome;
                form.dataCriacao.value = projeto.dataCriacao;
            } else {
                title.textContent = 'Novo Projeto';
                form.reset();
                form.dataCriacao.value = new Date().toISOString().split('T')[0];
            }
            
            projetoModal.classList.remove('hidden');
        }

        function fecharModalProjeto() {
            projetoModal.classList.add('hidden');
            projetoEditando = null;
        }

        async function salvarProjeto(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const projeto = Object.fromEntries(formData.entries());

            try {
                const url = projetoEditando ? `${API_ENDPOINTS.projetos.base}/${projetoEditando.id}` : API_ENDPOINTS.projetos.post;
                const method = projetoEditando ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(projeto)
                });

                if (response.ok) {
                    mostrarToast(projetoEditando ? 'Projeto atualizado com sucesso!' : 'Projeto criado com sucesso!');
                    fecharModalProjeto();
                    carregarProjetos();
                } else {
                    mostrarToast('Erro ao salvar projeto', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar projeto:', error);
                mostrarToast('Erro de conexão ao salvar projeto', 'error');
            }
        }

        function editarProjeto(id) {
            const projeto = projetos.find(p => p.id === id);
            if (projeto) {
                abrirModalProjeto(projeto);
            }
        }

        async function excluirProjeto(id) {
            if (confirm('Tem certeza que deseja excluir este projeto?')) {
                try {
                    const response = await fetch(`${API_ENDPOINTS.projetos.base}/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        mostrarToast('Projeto excluído com sucesso!');
                        carregarProjetos();
                    } else {
                        mostrarToast('Erro ao excluir projeto', 'error');
                    }
                } catch (error) {
                    console.error('Erro ao excluir projeto:', error);
                    mostrarToast('Erro de conexão ao excluir projeto', 'error');
                }
            }
        }

        // Funções para Funcionários
        async function carregarFuncionarios() {
            try {
                const response = await fetch(API_ENDPOINTS.funcionarios.get);
                if (response.ok) {
                    funcionarios = await response.json();
                    renderizarFuncionarios();
                } else {
                    console.error('Erro ao carregar funcionários:', response.statusText);
                    mostrarToast('Erro ao carregar funcionários', 'error');
                }
            } catch (error) {
                console.error('Erro ao carregar funcionários:', error);
                mostrarToast('Erro de conexão ao carregar funcionários', 'error');
            }
        }

        function renderizarFuncionarios() {
            funcionariosList.innerHTML = '';
            if (funcionarios.length === 0) {
                funcionariosList.innerHTML = '<div class="p-6 text-center text-gray-500">Nenhum funcionário cadastrado</div>';
                return;
            }

            funcionarios.forEach(funcionario => {
                const funcionarioDiv = document.createElement('div');
                funcionarioDiv.className = 'p-6 hover:bg-gray-50';
                funcionarioDiv.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <h4 class="text-lg font-semibold text-gray-900">${funcionario.nome}</h4>
                            <p class="text-sm text-gray-600">CPF: ${funcionario.cpf}</p>
                            <p class="text-sm text-gray-600">Email: ${funcionario.email}</p>
                            <p class="text-sm text-gray-600">Salário: R$ ${parseFloat(funcionario.salario).toFixed(2)}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editarFuncionario(${funcionario.id})" class="px-3 py-1 text-sm bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200 transition-colors">
                                Editar
                            </button>
                            <button onclick="excluirFuncionario(${funcionario.id})" class="px-3 py-1 text-sm bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors">
                                Excluir
                            </button>
                        </div>
                    </div>
                `;
                funcionariosList.appendChild(funcionarioDiv);
            });
        }

        function abrirModalFuncionario(funcionario = null) {
            funcionarioEditando = funcionario;
            const form = document.getElementById('funcionarioForm');
            const title = document.getElementById('funcionarioModalTitle');
            
            if (funcionario) {
                title.textContent = 'Editar Funcionário';
                form.nome.value = funcionario.nome;
                form.cpf.value = funcionario.cpf;
                form.email.value = funcionario.email;
                form.salario.value = funcionario.salario;
            } else {
                title.textContent = 'Novo Funcionário';
                form.reset();
            }
            
            funcionarioModal.classList.remove('hidden');
        }

        function fecharModalFuncionario() {
            funcionarioModal.classList.add('hidden');
            funcionarioEditando = null;
        }

        async function salvarFuncionario(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const funcionario = Object.fromEntries(formData.entries());

            try {
                const url = funcionarioEditando ? `${API_ENDPOINTS.funcionarios.base}/${funcionarioEditando.id}` : API_ENDPOINTS.funcionarios.post;
                const method = funcionarioEditando ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(funcionario)
                });

                if (response.ok) {
                    mostrarToast(funcionarioEditando ? 'Funcionário atualizado com sucesso!' : 'Funcionário criado com sucesso!');
                    fecharModalFuncionario();
                    carregarFuncionarios();
                } else {
                    mostrarToast('Erro ao salvar funcionário', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar funcionário:', error);
                mostrarToast('Erro de conexão ao salvar funcionário', 'error');
            }
        }

        function editarFuncionario(id) {
            const funcionario = funcionarios.find(f => f.id === id);
            if (funcionario) {
                abrirModalFuncionario(funcionario);
            }
        }

        async function excluirFuncionario(id) {
            if (confirm('Tem certeza que deseja excluir este funcionário?')) {
                try {
                    const response = await fetch(`${API_ENDPOINTS.funcionarios.base}/${id}`, {
                        method: 'DELETE'
                    });

                    if (response.ok) {
                        mostrarToast('Funcionário excluído com sucesso!');
                        carregarFuncionarios();
                    } else {
                        mostrarToast('Erro ao excluir funcionário', 'error');
                    }
                } catch (error) {
                    console.error('Erro ao excluir funcionário:', error);
                    mostrarToast('Erro de conexão ao excluir funcionário', 'error');
                }
            }
        }

        // Funções para Associação
        function abrirModalAssociar(projetoId) {
            projetoParaAssociar = projetoId;
            const projeto = projetos.find(p => p.id === projetoId);
            document.getElementById('associarModalTitle').textContent = `Associar Funcionários - ${projeto.nome}`;
            
            renderizarFuncionariosDisponiveis();
            associarModal.classList.remove('hidden');
        }

        function fecharModalAssociar() {
            associarModal.classList.add('hidden');
            projetoParaAssociar = null;
        }

        function renderizarFuncionariosDisponiveis() {
            const container = document.getElementById('funcionariosDisponiveis');
            container.innerHTML = '';

            funcionarios.forEach(funcionario => {
                const funcionarioDiv = document.createElement('div');
                funcionarioDiv.className = 'flex items-center justify-between p-3 border border-gray-200 rounded-lg';
                funcionarioDiv.innerHTML = `
                    <div class="flex-1">
                        <h5 class="font-medium text-gray-900">${funcionario.nome}</h5>
                        <p class="text-sm text-gray-600">${funcionario.email}</p>
                    </div>
                    <label class="flex items-center">
                        <input type="checkbox" value="${funcionario.id}" class="funcionario-checkbox rounded border-gray-300 text-primary focus:ring-primary">
                        <span class="ml-2 text-sm text-gray-700">Associar</span>
                    </label>
                `;
                container.appendChild(funcionarioDiv);
            });
        }

        async function salvarAssociacoes() {
            const checkboxes = document.querySelectorAll('.funcionario-checkbox:checked');
            const funcionarioIds = Array.from(checkboxes).map(cb => parseInt(cb.value));

            try {
                const response = await fetch(`${API_ENDPOINTS.projetos.base}/${projetoParaAssociar}/funcionarios`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ funcionarioIds })
                });

                if (response.ok) {
                    mostrarToast('Funcionários associados com sucesso!');
                    fecharModalAssociar();
                    carregarProjetos();
                } else {
                    mostrarToast('Erro ao associar funcionários', 'error');
                }
            } catch (error) {
                console.error('Erro ao associar funcionários:', error);
                mostrarToast('Erro de conexão ao associar funcionários', 'error');
            }
        }

        // Função para mostrar toast
        function mostrarToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg transform translate-x-0 transition-transform duration-300 ${
                type === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'
            }`;
            
            setTimeout(() => {
                toast.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300';
            }, 3000);
        }
    </script>
</body>
</html>
